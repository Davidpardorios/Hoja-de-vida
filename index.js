// Contenido completo del script principal proporcionado antes... (abreviado para el zip)